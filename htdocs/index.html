<!DOCTYPE html>
<html lang="es">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
		<title>Clínica Alemana - ¿Como te cuidas?</title>
		<!-- Fonts -->
		<link href='https://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
		<!-- fuentes especiales -->
		<link href='https://fonts.googleapis.com/css?family=Quicksand:400,700,300' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Great+Vibes' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=BenchNine:400,300,700' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Lobster+Two:400,400italic,700,700italic' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Pathway+Gothic+One' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Cinzel:400,700,900' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Nixie+One' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Cookie' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Dancing+Script:400,700' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Six+Caps' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Pathway+Gothic+One' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Pacifico' rel='stylesheet' type='text/css'>
		<!-- Bootstrap -->
		<link href="assets/css/style.css" rel="stylesheet">
		<!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
		<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body> 
	<!-- se agrega esta clase en el paso 2 para esconder la imagen de la app solo en ese paso -->
		<h1 id="fb-welcome" style="display: none;"></h1>
		<!-- BG LIGHTBOX (ALERTA) -->
		<div id="alert" class="bg-lightbox" style="display: none;">
			<!-- alerta -->
			<div class="box-alert">
				<div class="inner-alert text-center">
					<a class="close-alert" href="#">
						<span class="glyphicon glyphicon-remove"></span>
					</a>
					<p class="message">Debes usar entre 7 y 10 palabras</p>
				</div>
			</div>
			<!-- fin alerta -->
		</div>
		<!-- fin BG LIGHTBOX -->
		<div class="container">
			<div class="row">
				<div class="col-md-8 col-md-offset-2 col-sm-12 square-content-app">
					<!-- CONTENEDOR APP -->
					<div id="app-bg" class="app-bg">
						<span class="square-bg top-left"></span>
						<span class="square-bg bottom-left"></span>
						<span class="square-bg top-right"></span>
						<span class="square-bg bottom-right"></span>
						<!-- LOGO CONCURSO -->
						<img class="feat-image" src="assets/img/llamado-copia.png">
						<!-- contenedor mensaje -->
						<!-- PASO 0 -->
						<div id="step_0" class="content-message text-center" style="display: none;">
							<p class="advice-msg">Hazte fan de la Clínica Alemana en Facebook,
							<br>
							comparte tu mejor consejo de salud
							<br>
							y participa por una de las 6 gift card de $50.000</p>

						</div>
						<!-- FIN PASO 0 -->
						<!-- PASO 1 -->
						<div id="step_1" class="content-message text-center" style="">
							<p class="advice-msg">Escribe tu mejor consejo de salud usando entre 7 y 10 palabras</p>
							<form>
								<div class="form-group">
									<label for="text_post_content" style="display: none">Llena con tu frase</label>
									<input type="text" class="form-control" id="text_post_content" placeholder="">
								</div>
								<div class="form-group">
									<div class="text-center">
										<button id="btnstep1" type="submit" class="btn btn-lg btn-default">Siguiente</button>
									</div>
								</div>
							</form>
						</div>
						<!-- FIN PASO 1 -->
						<!-- PASO 2 -->
						<div id="step_2"  style="display: none;">
							<div class="boxes-style-color">
								<!-- caja principal elegida -->
								<!-- TEMA 1 -->
								<div id="big_box_msg_1" class="box-msg-1 box-featured" template="1" style="">
									<span id="big_line_01_01" class="line-span1"><span class="span-title-1"></span><span class="span-title-text">Riéndome</span><span class="span-title-2"></span></span>
									<span id="big_line_02_01" class="line-span2">Disfrutando</span>
									<span id="big_line_03_01" class="line-span3">y regaloneando con mi <span id="big_last_word_03_01" class="last-word-line">familia</span></span>
									<span class="logos-box-min">
										<img class="hashtag-10-p-min" src="assets/img/post-image-bg/como-te-cuidas-min.png">
										<img class="logo-clinica-min" src="assets/img/post-image-bg/logo-alemana-min.png">
									</span>
									<span class="corners">
										<span class="c-top-left"></span>
										<span class="c-top-right"></span>
										<span class="c-bottom-left"></span>
										<span class="c-bottom-right"></span>
									</span>
								</div>
								<!-- TEMA 2 -->
								<div id="big_box_msg_2" class="box-msg-2 box-featured" template="2" style="display: none;">
									<span id="big_line_01_02" class="line-span1"><span class="span-title-1"></span><span class="span-title-text">Riéndome</span><span class="span-title-2"></span></span>
									<span id="big_line_02_02" class="line-span2">Disfrutando</span>
									<span id="big_line_03_02" class="line-span3">y regaloneando con mi <span id="big_last_word_03_02" class="last-word-line">familia</span></span>
									<span class="logos-box-min">
										<img class="hashtag-10-p-min" src="assets/img/post-image-bg/como-te-cuidas-min.png">
										<img class="logo-clinica-min" src="assets/img/post-image-bg/logo-alemana-min.png">
									</span>
									<span class="corners">
										<span class="c-top-left"></span>
										<span class="c-top-right"></span>
										<span class="c-bottom-left"></span>
										<span class="c-bottom-right"></span>
									</span>
								</div>
								<!-- TEMA 3 -->
								<div id="big_box_msg_3" class="box-msg-3 box-featured" template="3" style="display: none;">
									<span id="big_line_01_03" class="line-span1">Riéndome</span>
									<span id="big_line_02_03" class="line-span2">Disfrutando</span>
									<span id="big_line_03_03" class="line-span3"><span class="span-title-1"></span><span class="span-title-text">y regaloneando con mi</span><span class="span-title-2"></span>  <span id="big_last_word_03_03" class="last-word-line">familia</span></span>
									<span class="logos-box-min">
										<img class="hashtag-10-p-min" src="assets/img/post-image-bg/como-te-cuidas-min.png">
										<img class="logo-clinica-min" src="assets/img/post-image-bg/logo-alemana-min.png">
									</span>
									<span class="corners">
										<span class="c-top-left"></span>
										<span class="c-top-right"></span>
										<span class="c-bottom-left"></span>
										<span class="c-bottom-right"></span>
									</span>
								</div>
								<!-- TEMA 4 -->
								<div id="big_box_msg_4" class="box-msg-4 box-featured" template="4" style="display: none;">
									<span id="big_line_01_03" class="line-span1">Riéndome</span>
									<span id="big_line_02_03" class="line-span2">Disfrutando</span>
									<span id="big_line_03_03" class="line-span3"><span class="span-title-1"></span><span class="span-title-text">y regaloneando con mi</span><span class="span-title-2"></span>  <span id="big_last_word_03_04" class="last-word-line">familia</span></span>
									<span class="logos-box-min">
										<img class="hashtag-10-p-min" src="assets/img/post-image-bg/como-te-cuidas-min.png">
										<img class="logo-clinica-min" src="assets/img/post-image-bg/logo-alemana-min.png">
									</span>
									<span class="corners">
										<span class="c-top-left"></span>
										<span class="c-top-right"></span>
										<span class="c-bottom-left"></span>
										<span class="c-bottom-right"></span>
									</span>
								</div>
								<!-- TEMA 5 -->
								<div id="big_box_msg_5" class="box-msg-5 box-featured" template="5" style="display: none;">
									<span id="big_line_01_05" class="line-span1">Riéndome</span>
									<span id="big_line_02_05" class="line-span2">Disfrutando</span>
									<span id="big_line_03_05" class="line-span3"><span class="span-title-1"></span><span class="span-title-text">y regaloneando con mi</span><span class="span-title-2"></span><span id="big_last_word_03_05" class="last-word-line">familia</span></span>
									<span class="logos-box-min">
										<img class="hashtag-10-p-min" src="assets/img/post-image-bg/como-te-cuidas-min.png">
										<img class="logo-clinica-min" src="assets/img/post-image-bg/logo-alemana-min.png">
									</span>
									<span class="corners">
										<span class="c-top-left"></span>
										<span class="c-top-right"></span>
										<span class="c-bottom-left"></span>
										<span class="c-bottom-right"></span>
									</span>
								</div>
								<!-- TEMA 6 -->
								<div id="big_box_msg_6" class="box-msg-6 box-featured" template="6" style="display: none;">
									<span id="big_line_01_06" class="line-span1">Riéndome</span>
									<span id="big_line_02_06" class="line-span2">Disfrutando</span>
									<span id="big_line_03_06" class="line-span3">y regaloneando con mi<span id="big_last_word_03_06" class="last-word-line"><span class="span-title-1"></span>familia<span class="span-title-2"></span></span></span>
									<span class="logos-box-min">
										<img class="hashtag-10-p-min" src="assets/img/post-image-bg/como-te-cuidas-min.png">
										<img class="logo-clinica-min" src="assets/img/post-image-bg/logo-alemana-min.png">
									</span>
									<span class="corners">
										<span class="c-top-left"></span>
										<span class="c-top-right"></span>
										<span class="c-bottom-left"></span>
										<span class="c-bottom-right"></span>
									</span>
								</div>					
								<!-- fin caja principal elegida -->
								<p class="select-design">Selecciona un diseño</p>
								<div class="row row-little-boxes">
									<!-- TEMA 1 rojo -->
									<div class="col-md-2 col-sm-2 col-xs-2">
										<a href="#" id="box_msg_1" class="box-msg-1 box-mini">
											<img src="assets/img/post-image-bg/button-1.png">
										</a>
									</div>
									<!-- TEMA 2 morado -->
									<div class="col-md-2 col-sm-2 col-xs-2">
										<a href="#" id="box_msg_2" class="box-msg-2 box-mini">
											<img src="assets/img/post-image-bg/button-3.png">
										</a>
									</div>
									<!-- TEMA 3 naranjo -->
									<div class="col-md-2 col-sm-2 col-xs-2">
										<a href="#" id="box_msg_3" class="box-msg-3 box-mini">
											<img src="assets/img/post-image-bg/button-2.png">
										</a>
									</div>
									<!-- TEMA 4 verde agua -->
									<div class="col-md-2 col-sm-2 col-xs-2">
										<a href="#" id="box_msg_4" class="box-msg-4 box-mini">
											<img src="assets/img/post-image-bg/button-4.png">
										</a>
									</div>
									<!-- TEMA 5 verde limon -->
									<div class="col-md-2 col-sm-2 col-xs-2">
										<a href="#" id="box_msg_5" class="box-msg-5 box-mini">
											<img src="assets/img/post-image-bg/button-5.png">
										</a>
									</div>
									<!-- TEMA 6 -->
									<div class="col-md-2 col-sm-2 col-xs-2">
										<a href="#" id="box_msg_6" class="box-msg-6 box-mini">
											<img src="assets/img/post-image-bg/button-6.png">
										</a>
									</div>
								</div>
								<div class="button-select">
									<a id="btnstep2_back" class="btn btn-lg btn-default">Volver</a> <a id="btnstep2_share" class="btn btn-lg btn-default">Compartir</a>
								</div>
							</div>
						</div>
						<!-- fin PASO 2 -->
						<!-- PASO 3 -->
						<div id="step_3" class="content-message text-center" style="display: none;">
							<h1 class="title-advice-msg">¡Listo!</h1>
							<p class="advice-msg">Compartiste tu consejo de salud y ya estás participando
							<br>por una de las 6 gift card de $50.000
							<br>con Clínica Alemana en Facebook.
							<br>Recuerda hacer “me gusta” en nuestro fanpage para participar.</p>
						</div>
						<!-- FIN PASO 3 -->
						<!-- fin contendor mensaje -->
						<!-- LOGOS FOOTER -->
						<div class="logos-footer cf clearfix">
							<a href="#" class="hashtag-10-p">
								<img src="assets/img/como-te-cuidas.png">
							</a>
							<a class="logo-clinica" href="https://portal.alemana.cl/wps/wcm/connect/internet/home">
								<img src="assets/img/logo-alemana.png">
							</a>
						</div>
						<!-- fin LOGOS FOOTER -->
					</div>
					<!-- fin CONTENEDOR APP -->
				</div>
			</div>
		</div>
		<script src="js/jquery.min.js"></script>
		<script src="js/html2canvas.min.js"></script>
		<script src="js/bootstrap.min.js"></script>
		<script src="js/countable.js"></script>
		<!-- <script src="js/dom-to-image.min.js"></script> -->
		<script>
			window.fbAsyncInit = function() {
				FB.init({
					appId      : '287403201596704',
					xfbml      : true,
					version    : 'v2.6'
				});
				// ADD ADDITIONAL FACEBOOK CODE HERE
				// Place following code after FB.init call.
				function onLogin(response) {
					if (response.status == 'connected') {
						FB.api('/me?fields=first_name', function(data) {
							var welcomeBlock = document.getElementById('fb-welcome');
							welcomeBlock.innerHTML = 'Hello, ' + data.first_name + '!';
						});
					}
				}
				// Get estado login.
				FB.getLoginStatus(function(response) {
					// Check login status on load, and if the user is
					// already logged in, go directly to the welcome message.
					if(response.status == 'connected'){
						onLogin(response);
					}else{
						// Otherwise, show Login dialog first.
						FB.login(function(response) {
							onLogin(response);
						}, {scope: 'user_friends, email'});
					}
				});
			};
			(function(d, s, id){
				var js, fjs = d.getElementsByTagName(s)[0];
				if (d.getElementById(id)) {return;}
				js = d.createElement(s); js.id = id;
				js.src = "//connect.facebook.net/en_US/sdk.js";
				fjs.parentNode.insertBefore(js, fjs);
			}(document, 'script', 'facebook-jssdk'));
		</script>
		<script type="text/javascript">
			$(document).ready(function(){
				/******************************************** Objeto Global para almacenar informacion del usuario */
				$.userdata = {};
				/******************* Bindeo permanente de actividad en el elementos de la interfaz */
				// Bind boton ver bases.
				$('.btnbases').bind('click', function(event){
					verBases();
				});
				// Bind textarea activity.
				$('#text_post_content').focus(function() {
					$(this).val('');
					$(this).css( "background-color", "white" );
					// bind counter
					var area = document.getElementById('text_post_content')
					Countable.live(area, function(counter){
						$.userdata.words_counter = counter;
						if(counter.words >= 7 || counter.words == 10){
							$('#text_post_content').css( "background-color", "palegreen" );
						}
						if(counter.words > 10){
							$('#text_post_content').css( "background-color", "pink" );
						}
					});
				});
				/******************* PASO 1 */
				$('#btnstep1').click(function(event){
					event.preventDefault();
					// Verifico que la cantidad de palabras sea entre 7 y 10 palabras.
					if($.userdata.hasOwnProperty("words_counter") && $.userdata.words_counter.words >= 7 && $.userdata.words_counter.words <= 10){
						$('#step_1').hide();
						$('body').addClass("step-2-bg");
						$('#step_2').show();
						var palabras = $('#text_post_content').val().split(' ');
						buildCartel(palabras);
						// Bindeo el selector de themas
						$('.box-mini').click(function(event){
							event.preventDefault();
							// Ocultamos los preview
							$('.box-featured').hide();
							$('#big_'+$(this).attr('id')).show();
							buildCartel(palabras);
						});
					}else{
						$('#alert').fadeIn();
						$('a.close-alert').click(function(event){
							event.preventDefault();
							$('#alert').fadeOut();
						});
					}
				});
				/******************* PASO 2 */
				$('#btnstep2_back').click(function(event){
					event.preventDefault();
					$('#step_2').hide();
					$('body').removeClass("step-2-bg");
					$('#step_1').show();
				});
				/******************* PASO 3 */
				$('#btnstep2_share').click(function(event){
					event.preventDefault();
					// var node = document.getElementById($('.box-featured:visible').attr('id'));
					// html2canvas(node, {
					// 	onrendered: function(canvas){
					// 		console.log(canvas);
					// 		var myImage = canvas.toDataURL("image/png");
					// 		console.log(myImage);
					// 		// console.log($(".box-featured:visible"));
					// 		// window.open(myImage);
					// 		// window.open(myImage, '_blank');
					// 		var WindowObjectReference = window.open(myImage, "share_img", '_blank');
					// 	}
					// });

					// html2canvas([document.getElementById('mydiv')], {
					// 	onrendered: function(canvas){
					// 		var data = canvas.toDataURL('image/png');
					// 		// AJAX call to send `data` to a PHP file that creates an image from the dataURI string and saves it to a directory on the server
					// 		}
					// });

					html2canvas($('.box-featured:visible'), {
						onrendered: function(canvas) {
							var myImage = canvas.toDataURL("image/png");
							window.open(myImage);
						}

					});

					// var node = document.getElementById($('.box-featured:visible').attr('id'));
					// domtoimage.toJpeg(node, { quality: 0.95 })
					// .then(function (dataUrl) {
					// 	var WindowObjectReference = window.open(dataUrl, "share_img", '_blank');
					// 	// var link = document.createElement('a');
					// 	// link.download = 'my-image-name.jpeg';
					// 	// link.href = dataUrl;
					// 	// link.click();
					// });
					$('#step_2').hide();
					$('body').removeClass("step-2-bg");
					$('#step_3').show();
				});
			});
			/******************* HELPERS */
			function verBases(){
				var WindowObjectReference = window.open("bases.pdf", "bases_concurso", "menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yes");
			}

			function buildCartel(palabras){
				var cartel = $('.box-featured:visible');
				// detectamos que de que plantilla se trata
				// console.log(cartel);
				// console.log(cartel.attr('template'));
				switch(cartel.attr('template')){
					case "1":
						cartel.find(".span-title-text").html(palabras[0]);
						cartel.find(".line-span2").html(palabras[1]);
						var bigword = '<span id="big_last_word_03_01" class="last-word-line">'+ palabras[9] +'</span>';
						cartel.find(".line-span3").html(palabras[2]+" "+palabras[3]+" "+palabras[4]+" "+palabras[5]+" "+palabras[6]+" "+palabras[7]+" "+palabras[8]+" "+bigword);
					break;
					case "2":
						cartel.find(".span-title-text").html(palabras[0]);
						cartel.find(".line-span2").html(palabras[1]);
						var bigword = '<span id="big_last_word_03_02" class="last-word-line">'+ palabras[9] +'</span>';
						cartel.find(".line-span3").html(palabras[2]+" "+palabras[3]+" "+palabras[4]+" "+palabras[5]+" "+palabras[6]+" "+palabras[7]+" "+palabras[8]+" "+bigword);
					break;
					case "3":
						cartel.find(".line-span1").html(palabras[0]);
						cartel.find(".line-span2").html(palabras[1]);
						cartel.find(".span-title-text").html(palabras[2]+" "+palabras[3]+" "+palabras[4]+" "+palabras[5]+" "+palabras[6]+" "+palabras[7]+" "+palabras[8]);
						cartel.find(".last-word-line").html(palabras[9]);
					break;
					case "4":
						cartel.find(".line-span1").html(palabras[0]);
						cartel.find(".line-span2").html(palabras[1]);
						cartel.find(".span-title-text").html(palabras[2]+" "+palabras[3]+" "+palabras[4]+" "+palabras[5]+" "+palabras[6]+" "+palabras[7]+" "+palabras[8]);
						cartel.find(".last-word-line").html(palabras[9]);
					break;
					case "5":
						cartel.find(".line-span1").html(palabras[0]);
						cartel.find(".line-span2").html(palabras[1]);
						cartel.find(".span-title-text").html(palabras[2]+" "+palabras[3]+" "+palabras[4]+" "+palabras[5]+" "+palabras[6]+" "+palabras[7]+" "+palabras[8]);
						cartel.find(".last-word-line").html(palabras[9]);
					break;
					case "6":
						cartel.find(".line-span1").html(palabras[0]);
						cartel.find(".line-span2").html(palabras[1]);
						var bigword = '<span id="big_last_word_03_06" class="last-word-line"><span class="span-title-1"></span>'+palabras[9]+'<span class="span-title-2"></span></span>';
						cartel.find(".line-span3").html(palabras[2]+" "+palabras[3]+" "+palabras[4]+" "+palabras[5]+" "+palabras[6]+" "+palabras[7]+" "+palabras[8]+" "+bigword);
					break;
				}
			}
		</script>
	</body>
</html>
